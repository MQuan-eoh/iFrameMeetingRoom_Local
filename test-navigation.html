<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Navigation Fix</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .test-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin: 0 auto;
      }
      .iframe-container {
        width: 100%;
        height: 600px;
        border: 2px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 20px;
      }
      .iframe-container iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
      .test-info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
        border-left: 4px solid #007bff;
      }
      .test-steps {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
      }
      .test-steps ol {
        margin: 0;
        padding-left: 20px;
      }
      .test-steps li {
        margin-bottom: 8px;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        font-weight: bold;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üß™ Test Navigation Fix for Meeting Room System</h1>

      <div class="test-info">
        <h3>üìã M·ª•c ƒë√≠ch test:</h3>
        <p>
          Ki·ªÉm tra vi·ªác navigation quay v·ªÅ home page t·ª´ room detail kh√¥ng c√≤n
          g√¢y reload trang khi s·ª≠ d·ª•ng trong iframe.
        </p>
      </div>

      <div class="test-steps">
        <h3>üîß C√°c b∆∞·ªõc test:</h3>
        <ol>
          <li>Load ·ª©ng d·ª•ng trong iframe b√™n d∆∞·ªõi</li>
          <li>Click v√†o button "P.H·ªåP L·∫¶U 3" ho·∫∑c "P.H·ªåP L·∫¶U 4"</li>
          <li>Ch·ªù page chuy·ªÉn sang room detail view</li>
          <li>Click button "Back to Home" (üè†)</li>
          <li>
            Quan s√°t: Page should navigate back WITHOUT reloading the iframe
          </li>
        </ol>
      </div>

      <div class="status success" id="testStatus" style="display: none">
        ‚úÖ Test th√†nh c√¥ng: Navigation ho·∫°t ƒë·ªông m√† kh√¥ng reload iframe
      </div>

      <div class="status warning" id="warningStatus" style="display: none">
        ‚ö†Ô∏è Ch√∫ √Ω: N·∫øu iframe b·ªã reload ho√†n to√†n th√¨ fix ch∆∞a ho·∫°t ƒë·ªông
      </div>

      <div class="iframe-container">
        <iframe
          src="index.html"
          id="testIframe"
          title="Meeting Room System Test"
        >
          <p>Your browser does not support iframes.</p>
        </iframe>
      </div>

      <div style="margin-top: 20px">
        <h3>üîç Debug Information:</h3>
        <div
          id="debugInfo"
          style="
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
          "
        >
          Waiting for iframe load...
        </div>

        <div style="margin-top: 15px">
          <h4>üß™ Manual Test Controls:</h4>
          <button
            onclick="checkIframeState()"
            style="
              margin: 5px;
              padding: 8px 12px;
              background: #007bff;
              color: white;
              border: none;
              border-radius: 4px;
            "
          >
            Check Iframe State
          </button>
          <button
            onclick="testRoomNavigation()"
            style="
              margin: 5px;
              padding: 8px 12px;
              background: #28a745;
              color: white;
              border: none;
              border-radius: 4px;
            "
          >
            Test Room Nav
          </button>
          <button
            onclick="testHomeNavigation()"
            style="
              margin: 5px;
              padding: 8px 12px;
              background: #ffc107;
              color: black;
              border: none;
              border-radius: 4px;
            "
          >
            Test Home Nav
          </button>
          <button
            onclick="restoreIframe()"
            style="
              margin: 5px;
              padding: 8px 12px;
              background: #dc3545;
              color: white;
              border: none;
              border-radius: 4px;
            "
          >
            Restore Iframe
          </button>
        </div>
      </div>
    </div>

    <script>
      const iframe = document.getElementById("testIframe");
      const debugInfo = document.getElementById("debugInfo");
      const testStatus = document.getElementById("testStatus");
      const warningStatus = document.getElementById("warningStatus");

      let loadCount = 0;
      let navigationCount = 0;

      // Monitor iframe loads
      iframe.addEventListener("load", function () {
        loadCount++;
        const timestamp = new Date().toLocaleTimeString();

        debugInfo.innerHTML += `<br>[${timestamp}] Iframe loaded (count: ${loadCount})`;

        if (loadCount === 1) {
          debugInfo.innerHTML += `<br>[${timestamp}] ‚úÖ Initial load - this is expected`;
          warningStatus.style.display = "block";
        } else if (loadCount > 1) {
          debugInfo.innerHTML += `<br>[${timestamp}] ‚ö†Ô∏è Additional reload detected - fix may not be working correctly`;
          warningStatus.style.display = "block";
          testStatus.style.display = "none";
        }

        // Try to access iframe content and monitor navigation
        try {
          const iframeDocument =
            iframe.contentDocument || iframe.contentWindow.document;

          // Monitor for navigation events
          iframe.contentWindow.addEventListener("hashchange", function () {
            navigationCount++;
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<br>[${timestamp}] Hash changed (navigation: ${navigationCount})`;

            if (navigationCount > 0 && loadCount === 1) {
              testStatus.style.display = "block";
              warningStatus.style.display = "none";
              debugInfo.innerHTML += `<br>[${timestamp}] ‚úÖ Navigation without reload detected!`;
            }
          });

          // Monitor for custom navigation events
          iframe.contentWindow.addEventListener("navigateToHome", function (e) {
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<br>[${timestamp}] üè† navigateToHome event detected from: ${e.detail?.from}`;
          });

          iframe.contentWindow.addEventListener(
            "homeNavigationComplete",
            function (e) {
              const timestamp = new Date().toLocaleTimeString();
              debugInfo.innerHTML += `<br>[${timestamp}] ‚úÖ homeNavigationComplete event detected from: ${e.detail?.from}`;

              if (loadCount === 1) {
                testStatus.style.display = "block";
                warningStatus.style.display = "none";
              }
            }
          );
        } catch (error) {
          const timestamp = new Date().toLocaleTimeString();
          debugInfo.innerHTML += `<br>[${timestamp}] ‚ÑπÔ∏è Cannot access iframe content (CORS) - monitoring load events only`;
        }
      });

      // Provide manual test verification
      setTimeout(() => {
        debugInfo.innerHTML += `<br><br>üìã Manual Test Instructions:
            <br>1. Click "P.H·ªåP L·∫¶U 3" or "P.H·ªåP L·∫¶U 4" button in the iframe
            <br>2. Wait for room detail page to load
            <br>3. Click "Back to Home" button (üè†)
            <br>4. If the iframe content changes without a full reload, the fix is working!`;
      }, 2000);

      // Manual test functions
      window.checkIframeState = function () {
        try {
          const iframeWindow = iframe.contentWindow;
          const iframeDocument =
            iframe.contentDocument || iframeWindow.document;

          const state = {
            meetingContainer:
              !!iframeDocument.querySelector(".meeting-container"),
            contentWrapper: !!iframeDocument.querySelector(".content-wrapper"),
            roomsContainer: !!iframeDocument.querySelector(".rooms-container"),
            roomPageWrapper:
              !!iframeDocument.querySelector(".room-page-wrapper"),
            roomSections:
              iframeDocument.querySelectorAll(".room-section").length,
            leftColumnVisible:
              iframeDocument.querySelector(".left-column")?.style.display !==
              "none",
            rightColumnVisible:
              iframeDocument.querySelector(".right-column")?.style.display !==
              "none",
          };

          const timestamp = new Date().toLocaleTimeString();
          debugInfo.innerHTML += `<br>[${timestamp}] üîç Iframe State Check:`;
          debugInfo.innerHTML += `<br>  meeting-container: ${state.meetingContainer}`;
          debugInfo.innerHTML += `<br>  content-wrapper: ${state.contentWrapper}`;
          debugInfo.innerHTML += `<br>  rooms-container: ${state.roomsContainer}`;
          debugInfo.innerHTML += `<br>  room-page-wrapper: ${state.roomPageWrapper}`;
          debugInfo.innerHTML += `<br>  room-sections: ${state.roomSections}`;
          debugInfo.innerHTML += `<br>  left-column visible: ${state.leftColumnVisible}`;
          debugInfo.innerHTML += `<br>  right-column visible: ${state.rightColumnVisible}`;
        } catch (error) {
          const timestamp = new Date().toLocaleTimeString();
          debugInfo.innerHTML += `<br>[${timestamp}] ‚ùå Cannot access iframe content: ${error.message}`;
        }
      };

      window.testRoomNavigation = function () {
        try {
          const iframeWindow = iframe.contentWindow;

          if (iframeWindow.debugNav) {
            iframeWindow.debugNav.testRoom();
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<br>[${timestamp}] üß™ Triggered room navigation test`;
          } else {
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<br>[${timestamp}] ‚ö†Ô∏è Debug nav not available in iframe`;
          }
        } catch (error) {
          const timestamp = new Date().toLocaleTimeString();
          debugInfo.innerHTML += `<br>[${timestamp}] ‚ùå Cannot test room navigation: ${error.message}`;
        }
      };

      window.testHomeNavigation = function () {
        try {
          const iframeWindow = iframe.contentWindow;

          if (iframeWindow.debugNav) {
            iframeWindow.debugNav.testHome();
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<br>[${timestamp}] üß™ Triggered home navigation test`;
          } else {
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<br>[${timestamp}] ‚ö†Ô∏è Debug nav not available in iframe`;
          }
        } catch (error) {
          const timestamp = new Date().toLocaleTimeString();
          debugInfo.innerHTML += `<br>[${timestamp}] ‚ùå Cannot test home navigation: ${error.message}`;
        }
      };

      window.restoreIframe = function () {
        try {
          const iframeWindow = iframe.contentWindow;

          if (iframeWindow.debugNav) {
            iframeWindow.debugNav.restore();
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<br>[${timestamp}] üîß Triggered iframe restoration`;
          } else {
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<br>[${timestamp}] ‚ö†Ô∏è Debug nav not available in iframe`;
          }
        } catch (error) {
          const timestamp = new Date().toLocaleTimeString();
          debugInfo.innerHTML += `<br>[${timestamp}] ‚ùå Cannot restore iframe: ${error.message}`;
        }
      };
    </script>
  </body>
</html>
